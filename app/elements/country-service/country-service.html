<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">


<dom-module id="country-service">
  <style>
    :host {
      display: none;
    }
  </style>
  <template>
    <iron-ajax id="ajax"
               auto
               url="http://localhost:3000/api/posts.json"
               handle-as="json"
               on-response="handleResponse" on-error="handleError"></iron-ajax>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'country-service',

    properties: {

      /**
       * response data
       */
      data: {
        type: Object,
        notify: true
      }
    },

    /**
     * handleResponse. if error occur on get data it make list null
     *
     * @method handleResponse
     */
    handleResponse: function () {
      this.data = this.$.ajax.lastResponse;
    },

    /**
     * handle error. if error occur on get data it make list null
     *
     * @method handleError
     */
    handleError: function () {
      this.data = [];
    },

    /**
     * Performs slice array.
     *
     * @method getIndexData
     */
    getIndexData: function (searchResult, startIndex, endIndex) {
      return _.slice(searchResult, startIndex, endIndex);
    },

    /**
     * Performs search data and return slected index data.
     *
     * @method searchData
     */
    searchData: function (input,selectedItems, startIndex, endIndex) {
      var searchResult = [];
      if (input !== '') {
        searchResult = _.select(this.$.ajax.lastResponse, function (n) {
          return (n.name.toLowerCase().indexOf(input.toLowerCase()) > -1);
        });
      }

      _.remove(searchResult, function(n) {
        return (_.findIndex(selectedItems, n) !== -1);
      });

      var service = {
        data: this.getIndexData(searchResult, startIndex, endIndex),
        totalCount: searchResult.length
      };
      return service;
    }

  });
</script>
