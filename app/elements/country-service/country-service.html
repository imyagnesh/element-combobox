<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">


<dom-module id="country-service">
  <style>
    :host {
      display: none;
    }
  </style>
  <template>
    <!--<iron-ajax id="ajax"-->
    <!--auto-->
    <!--url="http://localhost:3000/api/posts.json"-->
    <!--handle-as="json"-->
    <!--on-response="handleResponse" on-error="handleError"></iron-ajax>-->

    <span class="select2 select2-container select2-container--default" dir="ltr" style="width: 360px;">
    <span class="selection">
    <template is="dom-if" if="{{multi}}">
    <span class="select2-selection select2-selection--multiple" tabindex="0">
    <ul class="select2-selection__rendered">
      <template is="dom-repeat" items="{{selected}}" id="selectedRepeater">
        <li class="select2-selection__choice"><span role="presentation"
                                                    class="select2-selection__choice__remove"
                                                    on-click="removeItem">Ã—</span>{{item.name}}
        </li>
      </template>
      <li class="select2-search select2-search--inline">
        <input type="search" role="textbox" spellcheck="false" autocapitalize="off" autocorrect="off"
               autocomplete="off" tabindex="-1" class="select2-search__field" on-input="searchVal"
               value="{{hostValue::input}}" disabled$="{{isDisabled}}">
      </li>
    </ul>
    </span>
    </template>
    <template is="dom-if" if="{{!multi}}">
    <span class="select2-selection select2-selection--single" tabindex="0">
    <span class="select2-selection__rendered" id="select2-jori-container" title="Alaska">Alaska</span>
    <span role="presentation" class="select2-selection__arrow" on-click="openDropDown"><b
      role="presentation"></b></span>
    </span>
    </template>


    </span>
    </span>

    <!--<div id="Loading" hidden$="{{!enabled}}">-->
    <!--Loading...-->
    <!--</div>-->
    <!--<div hidden$="{{checkMinChar(hostValue,minimumInputLength)}}">-->
    <!--Please enter <span>{{minimumInputLength}}</span> or more characters-->
    <!--</div>-->

    <!--<span class="select2-container select2-container--default select2-container--open">-->
    <!--<span class="select2-dropdown select2-dropdown--below" dir="ltr" style="width: 360px;">-->
    <!--<span class="select2-search select2-search--dropdown">-->
    <!--<input type="search" role="textbox" spellcheck="false" autocapitalize="off" autocorrect="off" autocomplete="off"-->
    <!--tabindex="0" class="select2-search__field"></span>-->
    <!--<span class="select2-results">-->
    <!--<ul role="tree" class="select2-results__options" id="select2-qezz-results" aria-expanded="true"-->
    <!--aria-hidden="false">-->
    <!--<li class="select2-results__option" role="treeitem">Please enter 1 or more characters</li>-->
    <!--</ul>-->
    <!--</span>-->
    <!--</span>-->
    <!--</span>-->


    <iron-collapse fixedSize="true" id="collapse1" opened="{{isOpen}}">
      <!--<div id="collapse" class="collapse" style="width: 360px;">-->
    <span class="select2-container select2-container--default select2-container--open">
    <span style="width: 360px;" dir="ltr" class="select2-dropdown select2-dropdown--below">
    <template is="dom-if" if="{{!multi}}">
    <span class="select2-search select2-search--dropdown">
    <input type="search" role="textbox" spellcheck="false" autocapitalize="off" autocorrect="off"
           autocomplete="off" tabindex="-1" class="select2-search__field" on-input="searchVal"
           value="{{hostValue::input}}" disabled$="{{isDisabled}}">
    </span>
    </template>
    <!--<div id="Loading" hidden$="{{!enabled}}">-->
    <!--Searching...-->
    <!--</div>-->

    <span class="select2-results" id="scroll" on-scroll="scrollData">
    <ul role="tree" class="select2-results__options" aria-expanded="true" aria-hidden="false">
      <li class="select2-results__option" role="treeitem"
          hidden$="{{checkMinChar(hostValue,minimumInputLength)}}">Please enter
        <span>{{minimumInputLength}}</span> or more characters
      </li>
      <template is="dom-repeat" items="{{cData}}" id="dataRepeater">
        <li class="select2-results__option select2-results__option--highlighted" role="treeitem"
            aria-selected="false">{{item.name}}
        </li>
      </template>
    </ul>
    </span>
    </span>


    <!--<div id="scroll" on-scroll="scrollData">-->
    <!--<div class="canvas" id="canvas">-->
    <!--<template is="dom-repeat" items="{{cData}}" id="dataRepeater">-->
    <!--<div on-click="selectOption" class$="{{isSelected(item)}}" style$="{{computeTop(index)}}">{{item.name}}-->
    <!--</div>-->
    <!--</template>-->
    <!--</div>-->
    <!--</div>-->
    <!--</div>-->
    </span>
    </iron-collapse>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'country-service',

    properties: {

      /**
       * response data
       */
      data: {
        type: Object,
        notify: true
      }
    },

    /**
     * handleResponse. if error occur on get data it make list null
     *
     * @method handleResponse
     */
//    handleResponse: function () {
//      this.data = this.$.ajax.lastResponse;
//    },
//
//    /**
//     * handle error. if error occur on get data it make list null
//     *
//     * @method handleError
//     */
//    handleError: function () {
//      this.data = [];
//    },

    /**
     * Performs slice array.
     *
     * @method getIndexData
     */
    getIndexData: function (searchResult, startIndex, endIndex) {
      return _.slice(searchResult, startIndex, endIndex);
    },

    /**
     * Performs search data and return slected index data.
     *
     * @method searchData
     */
    searchData: function (input, selectedItems, startIndex, endIndex) {

      console.log(this.data);

      var searchResult = [];
      if (input !== '') {
        searchResult = _.select(this.data, function (n) {
          return (n.name.toLowerCase().indexOf(input.toLowerCase()) > -1);
        });
      }

      _.remove(searchResult, function (n) {
        return (_.findIndex(selectedItems, n) !== -1);
      });

      var service = {
        data: this.getIndexData(searchResult, startIndex, endIndex),
        totalCount: searchResult.length
      };
      return service;
    }

  });
</script>
